/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package presentation;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.*;

import javax.swing.*;
import javax.swing.border.Border;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import javax.swing.text.DateFormatter;
import javax.swing.text.DefaultFormatterFactory;

import services.PersistenceService;

public class QueryInterfaceUI extends javax.swing.JFrame implements ActionListener, ChangeListener {

   
	
	
	static final int WIDTH = 800;
	static final int HEIGHT = 220;

	static final String ACTION_RUN = "runQuery";
	

	static final double DEFAULT_AXIAL_TILT = 23.44;
	static final double DEFAULT_ORBITAL_ECCENTRICITY = .0167;
	private Date simStart, simEnd;
	private static final long serialVersionUID = -15968456987503L; 
	private double tilt;
	// persistence service
	private PersistenceService ps;
	private static QueryInterfaceUI instance;
	int WIDTH_LABELS = WIDTH * 4 / 7 * 1
			/ 4;
	int WIDTH_EDITS = WIDTH * 4 / 7 * 3
			/ 4;
	int LABEL_HEIGHT = 26;


	
	 /**
     * Creates new form QueryInterfaceUI
     */
   private QueryInterfaceUI() {
        
    	//ps = PersistenceService.getInstance();
    	createGui();
    	this.setVisible(true);
    	setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Query Interface");
        setName("QInterfaceFrame"); 
        
    }
    
  //Singleton, similar to Gui.java
  	public static QueryInterfaceUI getInstance() {
  		if (instance == null) {
  			instance = new QueryInterfaceUI();
  		}
  		return instance;
  	}

  	public static void destroy() {
		if (instance != null) {
			instance = null;
		}
	}

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void createGui() {
    	
    	
    	this.getContentPane().setPreferredSize(
				new Dimension(800, 620));
    	int EDIT_BOX_WIDTH = 4;
		int LABEL_HEIGHT = 26;
    	JPanel Panel;
		Panel = new JPanel();
		Panel.setBorder(BorderFactory.createMatteBorder(0, 1, 0, 1,
				Color.blue));
		Panel.setLayout(new java.awt.BorderLayout());
		//Panel.add(createPanel(), BorderLayout.CENTER);
		
		QueryInterfaceLabel = new javax.swing.JLabel();
        tableOptionsLabel = new javax.swing.JLabel();
        qrybuttonGroup1 = new ButtonGroup();
        regionbuttonGroup = new ButtonGroup();
        runQuery = new javax.swing.JButton();
        reset = new javax.swing.JButton();
        byNameButton = new JRadioButton();
        byPFButton = new JRadioButton();
        earthButton = new JRadioButton();
        parametersButton = new JRadioButton();
        jPanel1 = new javax.swing.JPanel();
        simulationNameLabel = new javax.swing.JLabel();
        //simulationNameField = new javax.swing.JTextField(20);
        axisTiltSlider = new javax.swing.JSlider();
        axisTiltLabel = new javax.swing.JLabel();
        orbitalEccentricityLabel = new javax.swing.JLabel();
        orbitalEccentricityField = new javax.swing.JTextField(EDIT_BOX_WIDTH);
        latitudeLabel = new javax.swing.JLabel();
        latitudeFromField = new javax.swing.JTextField(EDIT_BOX_WIDTH);
        jLabel10 = new javax.swing.JLabel();
        latitudeToField = new javax.swing.JTextField(EDIT_BOX_WIDTH);
        longitudeLabel = new javax.swing.JLabel();
        longitudeFromField = new javax.swing.JTextField(EDIT_BOX_WIDTH);
        jLabel11 = new javax.swing.JLabel();
        longitudeToField = new javax.swing.JTextField(EDIT_BOX_WIDTH);
        simulationPeriodLabel = new javax.swing.JLabel();
        simulationStartField = new javax.swing.JFormattedTextField();
        simulationStartField.setActionCommand(getName());
        simulationStartField.setMinimumSize( new Dimension(WIDTH_EDITS,
				HEIGHT));
        
        jLabel9 = new javax.swing.JLabel();
        simulationEndField = new javax.swing.JFormattedTextField();
        simulationEndField.setMinimumSize( new Dimension(WIDTH_EDITS,
				HEIGHT));
        simulationEndField.setActionCommand(getName());
        jPanel2 = new javax.swing.JPanel();
        minTempLabel = new javax.swing.JLabel();
        minTempCheckbox = new javax.swing.JCheckBox();
        regionMeanTempLabel = new javax.swing.JLabel();
        meanTempRegionCheckbox = new javax.swing.JCheckBox();
        maxTempLabel = new javax.swing.JLabel();
        maxTempRegionCheckbox = new javax.swing.JCheckBox();
        timeMeanTempLabel = new javax.swing.JLabel();
        meanTempTimeCheckbox = new javax.swing.JCheckBox();
        tempTimeRegionLabel = new javax.swing.JLabel();
        tempsTimeRegionCheckbox = new javax.swing.JCheckBox();
        
        QueryInterfaceLabel.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        QueryInterfaceLabel.setText("Query Interface");
        
        JLabel s1 = new JLabel("                                             ");
        JLabel s2 = new JLabel("                   ");
        JLabel s3 = new JLabel("   ");

		
		JPanel topPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
		topPanel.setPreferredSize(new Dimension(WIDTH_EDITS,
				HEIGHT));
		
    	qrybuttonGroup1.add(byNameButton); 
        byNameButton.setText("Name");
        byNameButton.setActionCommand("byName");
        byNameButton.addActionListener(this);
        qrybuttonGroup1.add(byPFButton);
        byPFButton.setText("Physical Factors");
        byPFButton.setActionCommand("byPF");
        byPFButton.addActionListener(this);
       

        simulationNameLabel.setText("Simulation name: ");
        
        nameSpinner = new JSpinner();
        nameSpinner.setName("Name");
        nameSpinner.setModel(new SpinnerNumberModel(1, 1, 100, 1));
        JPanel namePFPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
        namePFPanel.setPreferredSize(new Dimension(WIDTH_EDITS,
				HEIGHT));
        Border nameBorder = BorderFactory.createTitledBorder("Search by ");
        namePFPanel.setBorder(nameBorder);
        //namePFPanel.add(new JLabel("Search by: "));
        
        JPanel namePFRadioPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
        
        namePFRadioPanel.add(byNameButton);
        namePFRadioPanel.add(byPFButton);
        
        
        namePFPanel.add(namePFRadioPanel, BorderLayout.NORTH );
        
        
        
        
        
        namePFPanel.add(simulationNameLabel);
        namePFPanel.add(nameSpinner);
        
      
        topPanel.add(namePFPanel, BorderLayout.WEST);
        
        
        JPanel PFPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
        PFPanel.setPreferredSize(new Dimension(WIDTH_EDITS,
				HEIGHT));
        Border pfBorder = BorderFactory.createTitledBorder("Physical factors ");
        PFPanel.setBorder(pfBorder);
        axisTiltSlider.setMajorTickSpacing(60);
        axisTiltSlider.setMaximum(180);
        axisTiltSlider.setMinimum(-180);
        axisTiltSlider.setMinorTickSpacing(30);
        axisTiltSlider.setPaintLabels(true);
        axisTiltSlider.setPaintTicks(true);

        axisTiltLabel.setText("Axial tilt");
        axisTiltSlider.setPreferredSize(new Dimension(15, 75));
        
        orbitalEccentricityLabel.setText("Orbital eccentricity");
        PFPanel.add(axisTiltLabel);
        PFPanel.add(axisTiltSlider);
        PFPanel.add(orbitalEccentricityLabel);
        PFPanel.add(orbitalEccentricityField);
        
        topPanel.add(PFPanel, BorderLayout.EAST);
        this.getContentPane().add(topPanel, BorderLayout.NORTH);
        
        JPanel regionPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
        regionPanel.setPreferredSize(new Dimension(WIDTH_EDITS,
				HEIGHT));
        Border regionBorder = BorderFactory.createTitledBorder("Physical bounds ");
        regionPanel.setBorder(regionBorder);
        
        //regionPanel.add(new JLabel("Physical bounds"));
        regionPanel.add(s1);
        regionbuttonGroup.add(earthButton); 
        earthButton.setText("Whole Earth");
        earthButton.setActionCommand("earth");
        earthButton.addActionListener(this);
        regionbuttonGroup.add(parametersButton);
        parametersButton.setText("Use parameters provided");
        parametersButton.setActionCommand("parameters");
        parametersButton.addActionListener(this);
        
        regionPanel.add(earthButton);
        regionPanel.add(s3);
        regionPanel.add(parametersButton);
        
        latitudeLabel.setText("Latitude");
        regionPanel.add(latitudeLabel);
        regionPanel.add(new JLabel("Start"));
        regionPanel.add(latitudeFromField);
        regionPanel.add(new JLabel("End"));
        regionPanel.add(latitudeToField);
        longitudeLabel.setText("Longitude");
        regionPanel.add(longitudeLabel);
        regionPanel.add(new JLabel("Start"));
        regionPanel.add(longitudeFromField );
        regionPanel.add(new JLabel("End"));
        regionPanel.add(longitudeToField);
        
       
        this.getContentPane().add(regionPanel, BorderLayout.CENTER);

        JPanel periodPanel = new JPanel();
        periodPanel.setPreferredSize(new Dimension(WIDTH_EDITS,
				HEIGHT));
        Border periodBorder = BorderFactory.createTitledBorder("Time Period and other options ");
        periodPanel.setBorder(periodBorder);
        periodPanel.add(new JLabel("Simulation Time period"));
        periodPanel.add(new JLabel("Start time:"));
        periodPanel.add(simulationStartField);
        periodPanel.add(new JLabel("End time:"));
        periodPanel.add(simulationEndField);
        simulationStartField.setAction(simulationStartField.getAction());
        simulationEndField.setAction(simulationEndField.getAction());
        
        tableOptionsLabel.setFont(new java.awt.Font("Tahoma", 3, 11)); // NOI18N
        tableOptionsLabel.setText("Include following data in the result set");

        runQuery.setText("Run Query");
        runQuery.addActionListener(this);
		runQuery.setEnabled(true); 
        runQuery.setActionCommand(ACTION_RUN);
        periodPanel.add(runQuery);
        reset.setText("Reset");
        reset.addActionListener(this);
        reset.setEnabled(true); 
        reset.setActionCommand("reset");
        periodPanel.add(reset);
        
        minTempLabel.setText("Minumum temperature in the region selected");

        regionMeanTempLabel.setText("Mean temperature for the region selected");

        maxTempLabel.setText("Maximum temperature in the region selected");

        timeMeanTempLabel.setText("Mean temperature for the requested time period");

        tempTimeRegionLabel.setText("Temperatures for the requested region over the time period selected");
        
        periodPanel.add(minTempLabel);
        periodPanel.add(minTempCheckbox);
        periodPanel.add(regionMeanTempLabel);
        periodPanel.add(meanTempRegionCheckbox);
        periodPanel.add(maxTempLabel);
        periodPanel.add(maxTempRegionCheckbox);
        periodPanel.add(timeMeanTempLabel);
        periodPanel.add(meanTempTimeCheckbox);
        periodPanel.add(tempTimeRegionLabel);
        periodPanel.add(tempsTimeRegionCheckbox);

        this.getContentPane().add(periodPanel, BorderLayout.SOUTH);
        
        simulationEndField.addActionListener(this);
        
        

        pack();
    }// </editor-fold>//GEN-END:initComponents

         
    
    public void createOutputGui()
    {
    	this.getContentPane().setPreferredSize(
				new Dimension(800, 620));
    	int EDIT_BOX_WIDTH = 4;
		int LABEL_HEIGHT = 26;
    	JPanel Panel;
		Panel = new JPanel();
		Panel.setBorder(BorderFactory.createMatteBorder(0, 1, 0, 1,
				Color.blue));
		Panel.setLayout(new java.awt.BorderLayout());
		
		
		minTempLabel = new javax.swing.JLabel();
		 
		maxTempLabel = new javax.swing.JLabel();
		regionMeanTempLabel = new javax.swing.JLabel();
		timeMeanTempLabel = new javax.swing.JLabel();
		tempTimeRegionLabel = new javax.swing.JLabel();
		outputTable = new JTable();
		
		System.out.println("Inside createOutputGui method");
		JPanel topPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
		topPanel.setPreferredSize(new Dimension(WIDTH_EDITS,
				HEIGHT));
		JPanel labelPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
		labelPanel.add(minTempLabel);
		labelPanel.add(maxTempLabel);
		labelPanel.add(regionMeanTempLabel);
		labelPanel.add(timeMeanTempLabel);
		labelPanel.add(tempTimeRegionLabel);
		
		topPanel.add(labelPanel, BorderLayout.WEST);
		
		JPanel valuePanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
		
		valuePanel.add(new JLabel("23"));
		valuePanel.add(new JLabel("75"));
		valuePanel.add(new JLabel("45"));
		valuePanel.add(new JLabel("35"));
		valuePanel.add(new JLabel("54"));
		
		
		
		
        this.getContentPane().add(topPanel, BorderLayout.NORTH);
		JPanel bottomPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));
		bottomPanel.setPreferredSize(new Dimension(WIDTH_EDITS,
				HEIGHT));
		
		 outputTable.setModel(new javax.swing.table.DefaultTableModel(
		            new Object [][] {
		                {null, null, null, null},
		                {null, null, null, null},
		                {null, null, null, null},
		                {null, null, null, null}
		            },
		            new String [] {
		                "Title 1", "Title 2", "Title 3", "Title 4"
		            }
		        ));
		       
		 
	     this.getContentPane().add(bottomPanel, BorderLayout.SOUTH);
    	
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
       try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(QueryInterfaceUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(QueryInterfaceUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(QueryInterfaceUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(QueryInterfaceUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new QueryInterfaceUI().setVisible(true);
            }
        });
    }

    
    //set simulation start and end time.
    
    public void setSimulationPeriod(String start, String end)
    {
    	 SimpleDateFormat dtf 
         = new SimpleDateFormat("dd/MMM/yyyy HH:mm:ss.SSS");
    	 try{
    		 
    		 System.out.println("Sim start: " + simulationStartField.getText());
        	 System.out.println("Sim end: "+ simulationEndField.getText());
    	 simStart = dtf.parse(simulationStartField.getText());
    	 simEnd = dtf.parse(simulationEndField.getText());
    	 System.out.println("Sim start: " + simStart);
    	 System.out.println("Sim end: "+ simEnd);
    	 }
    	 catch(Exception e)
    	 {
    		 System.out.println("Error parsing date time");
    	 }
    }
    
    @Override
	public void actionPerformed(ActionEvent e) {
		//get the command
		String command = e.getActionCommand();
		
		if (command.equals("byName"))
		{
			//Remove 2 lines and add code to retrieve values from DB
			nameSpinner.setValue("Nov12-2014");
			nameSpinner.setValue("Oct19-2014");
			
			
		}
		else if(command.equals("byPF"))
		{
			
		}
		else if(command.equals("earth"))
		{
			
		}
		else if(command.equals("parameters"))
		{
			
		}
		else if (command.equals(ACTION_RUN)) {
			
			
			
			
			//disable all controls
			//this.setEnableAllUserOptions(false);
			//disable the run button
			//runQuery.setEnabled(false);
			
			//call persisitence controller here
			runQuery();
		}
		else if(command.equals("Reset"))
		{
			clear();
		}
		else if(command.equals(simulationEndField.getAction()))
		{
		 //simulationEndFieldActionPerformed(evt)
    	
			setSimulationPeriod(simulationStartField.getText(),simulationEndField.getText());
		}
    }
    
   
  //enable/disable all controls
  	private void setEnableAllUserOptions(boolean bEnable) {
  	
  		
  		
         runQuery.setEnabled(bEnable);
         simulationNameField.setEnabled(bEnable);
         axisTiltSlider.setEnabled(bEnable);
         orbitalEccentricityField.setEnabled(bEnable);
         latitudeFromField.setEnabled(bEnable);
         latitudeToField.setEnabled(bEnable);
         longitudeFromField.setEnabled(bEnable);
         longitudeToField.setEnabled(bEnable);
         simulationStartField.setEnabled(bEnable);
         simulationEndField.setEnabled(bEnable);
         minTempCheckbox.setEnabled(bEnable);
         meanTempRegionCheckbox.setEnabled(bEnable);
         maxTempRegionCheckbox.setEnabled(bEnable);
         meanTempTimeCheckbox.setEnabled(bEnable);
         tempsTimeRegionCheckbox.setEnabled(bEnable);

  	}

  	
  	public void clear()
  	{
  		simulationNameField.setText(null);
        //axisTiltSlider.setValue(0);
        orbitalEccentricityField.setText(null);
        latitudeFromField.setText(null);
        latitudeToField.setText(null);
        longitudeFromField.setText(null);
        longitudeToField.setText(null);
        simulationStartField.setText(null);
        simulationEndField.setText(null);
        minTempCheckbox.setSelected(false);
        meanTempRegionCheckbox.setSelected(false);
        maxTempRegionCheckbox.setSelected(false);
        meanTempTimeCheckbox.setSelected(false);
        tempsTimeRegionCheckbox.setSelected(false);
  	}
    //call persistence controller and execute the query. Create output ui 
  	//to display results
    public void runQuery()
    {
    	//for now it just prints all the values to console.
    	
    	//System.out.println("Name: "+ simulationNameField.getText());
    	System.out.println("Axial tilt: "+ axisTiltSlider.getValue());
    	System.out.println("ecc: "+ orbitalEccentricityField.getText());
    	System.out.println("latitude: "+ latitudeFromField.getText() + " to " + latitudeToField.getText());
    	System.out.println("longitude: "+ longitudeFromField.getText() + " to " + longitudeToField.getText());
    	System.out.println("simulation: "+ simulationStartField.getText() + " to " + simulationEndField.getText());
    	System.out.println("Min Temp "+ minTempCheckbox.isSelected());
    	System.out.println("Max Temp"+ maxTempRegionCheckbox.isSelected());
    	System.out.println("Regional avg temp "+ meanTempRegionCheckbox.isSelected());
    	System.out.println("Avg temp for the period "+ meanTempTimeCheckbox.isSelected() );
    	
    	createOutputGui();
    	
    	
    }
    
    public void stateChanged(ChangeEvent e) {

	}
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel QueryInterfaceLabel;
    private javax.swing.JLabel axisTiltLabel;
    private javax.swing.JSlider axisTiltSlider;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JTextField latitudeFromField;
    private javax.swing.JLabel latitudeLabel;
    private javax.swing.JTextField latitudeToField;
    private javax.swing.JTextField longitudeFromField;
    private javax.swing.JLabel longitudeLabel;
    private javax.swing.JTextField longitudeToField;
    private javax.swing.JLabel maxTempLabel;
    private javax.swing.JCheckBox maxTempRegionCheckbox;
    private javax.swing.JCheckBox meanTempRegionCheckbox;
    private javax.swing.JCheckBox meanTempTimeCheckbox;
    private javax.swing.JCheckBox minTempCheckbox;
    private javax.swing.JLabel minTempLabel;
    private javax.swing.JTextField orbitalEccentricityField;
    private javax.swing.JLabel orbitalEccentricityLabel;
    private javax.swing.JLabel regionMeanTempLabel;
    private javax.swing.JButton runQuery;
    private javax.swing.JButton reset;
    private javax.swing.JTextField simulationEndField;
    private javax.swing.JTextField simulationNameField;
    private javax.swing.JLabel simulationNameLabel;
    private javax.swing.JLabel simulationPeriodLabel;
    private javax.swing.JTextField simulationStartField;
    private javax.swing.JLabel tableOptionsLabel;
    private javax.swing.JLabel tempTimeRegionLabel;
    private javax.swing.JCheckBox tempsTimeRegionCheckbox;
    private javax.swing.JLabel timeMeanTempLabel;
    private ButtonGroup qrybuttonGroup1;
    private JRadioButton byNameButton;
    private JRadioButton byPFButton;
    private ButtonGroup regionbuttonGroup;
    private JRadioButton earthButton;
    private JRadioButton parametersButton;
    private JSpinner nameSpinner;
    private JTable outputTable;
    private JLabel spacer;
    
    // End of variables declaration//GEN-END:variables
    
           
}

